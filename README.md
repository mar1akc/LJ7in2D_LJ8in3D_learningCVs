# LJ7in2D_LJ8in3D_learningCVs
This package contains a collection of C codes for the paper

[1] Jiaxin Yuan, Shashank Sule, Yeuk Yin Lam, and Maria Cameron, *"Learning collective variables that respect permutational symmetry".* ArXiv:<TBA>.

This package is designed for computing the free energy and diffusion matrix with respect to the standard and given machine-learned collective variables (CVs) for two systems: Lennard-Jones-7 in 2D and Lennard-Jones-8 in 3D. The machine-learned collective variables are obtained by Algorithm 1 in [1] implemented in the codes in the GitHub Repository

[https://github.com/margotyjx/OrthogonalityCVLearning](https://github.com/margotyjx/OrthogonalityCVLearning)

Furthermore, this package offers C codes for forward flux sampling, generating transition trajectories using stochastic control, brute force sampling. 

The directories LJ7in2D and LJ8in3D contain the collections of codes for the respective systems. The subdirectories of these two main directories contain codes for different collective variables.

### Subdirectories of LJ7in2D:
- MLCV_sort_CNum: codes for the CVs learned by Algorithm 1 in [1] with the feature map sort[c], the sorted vector of coordination numbers of the atomic coordinates. The coordination number of an atom $$i$$ is a continuous function of atomic coordinates approximately equal to the number of the nearest neighbors of atom $$i$$:\
   $$c_i = \sum_{j\neq i} (1-r_{i,j}^8)/(1 - r_{i,j}^{16}).$$
- MLCV_sort_d2: codes for the CVs learned by Algorithm 1 in [1] with the feature map sort[d^2], the sorted vector of pairwise distances squared.
- mu2mu3: codes for the standard set of CVs $$(\mu_2,\mu_3)$$, the second and the third central moments of the coordination numbers.

### Subdirectories of LJ8in3D:
- LDA12_SortCNum_CV: codes for (LDA1,LDA2) CVs, the first and second dominant eigenvectors of the generalized eigenvalue problem in the Linear  Discriminant Analysis (see e.g. R. O. Duda, P. E. Hart, D. G. Stork "Pattern Classification", Section 3.8.3). The CVs (LDA1,LDA2) separate the union of the two lowest minima, 1 and 2, of LJ8 in 3D from the rest.
- LDA23_SortCNum_CV: codes for (LDA2,LDA3) CVs, the second third dominant eigenvectors of the generalized eigenvalue problem in the Linear  Discriminant Analysis. These CVs separate minima 1 and 2.
- MLCV_sort_CNum: codes for the CVs learned by Algorithm 1 in [1] with the feature map sort[c], the sorted vector of coordination numbers of the atomic coordinates. 
- mu2mu3: codes for CVs $$(\mu_2,\mu_3)$$, the second and the third central moments of the coordination numbers.

### The tree of codes in each directory:
1. macros_and_contants.h contains MACROs and important parameters:
- BETA ($$\beta = 1/(k_BT)$$)
- NATOMS (the number of atoms)
- DIM (2, or 3, the dimension of the space where the atoms move)
- CVDIM (2, the dimension of the CV)
- GAMMA, SIGMA, HEIGHT, NBUMPS_MAX, NSTEPS_BETWEEN_DEPOSITS (the parameters for the well-tempered metadynamics)
- N_MINIMA (the number of local minima in the system)
- KAPPA (the spring force parameter for the restraining potential)
- STARTING_MIN, FINISH_MIN, MSTONE_MIN_VAL, MSTONE_MAX_VAL (the parameters for the forward flux sapling (Allen et al., 2005, 2009)
- TAU (the time step size)
2. LJ<NATOMS>_WTMetad_<description of the CVs>.c runs the metadynamics algorithm. It may take files as input specified in the declaration of main() with the parameters and the dimensions of the CVs. If the CVs are $$(\mu_2,\mu_3)$$, no input files are required. If the CVs are LDAs, one input file is required. If CVs are given by a neural network, two input files are required. The first file contains the parameters of the neural network, and the other one contains its dimensions. All these files are found in the corresponding directories and generated by Matlab codes read_NN_data.m (or a similar name). This code outputs the file GaussianBumps_beta<BETA>.txt. You must have the directory named GBumpsData that you must have. You also must have a directory Data.
3. LJ<NTAOMS>in<DIM>D_bicubicFE_binning.c computes the free energy. It firsts creates a bounding box in the CV space containing all centers of the Gaussian bumps and meshes it into N2-by-N1 grid cells. It approximates the biasing potential given by the Gaussian bumps with a bicubic inperpolant. Then it runc a long trajectory of NSTEPS (set to 1e9) and computes the free energy by the binning approach. More details are found in the appendix of [1]. The output files are saved in the directory Data:
- bicubic_params.txt (N1,N2,h_1,h_2,CV1 min value, CV1 max value, CV2 min value, CV2 max value) -- a column vector
- LJ<NATOMS>bins_confs.txt -- atomic coordinates of representative configurations in all visited bins. If a bin was not visited, the configuration has all zero coordinates.
- LJ7bins_beta<BETA>.txt -- the number of visits to each bin.
- LJ<NATOMS>free_energy_beta<BETA>.txt is the free energy
- LJ<BETA>free_energy_bicubic_matrix_beta<BETA>.txt is a file of ~3Mb with data to for the bicubic interpolant of the free energy allowing to calculate it on any grid of a different size. We do not include it in the GitHub version due to its large size.
  
